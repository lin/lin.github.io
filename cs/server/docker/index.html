<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>- Yingkui</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta itemprop=name content="Yingkui"><meta itemprop=description content='Docker database and app should be treat separately. app install ruby rails node yarn gems ssh git should be handle differently. ruby rails node yarn ###============= # RUBY AND NODE ###============= ARG RUBY_VERSION=3.3.0 FROM registry.docker.com/library/ruby:$RUBY_VERSION-slim # Rails app lives here WORKDIR /rails # Set production environment ENV RAILS_ENV="production" \ BUNDLE_DEPLOYMENT="1" \ BUNDLE_PATH="/usr/local/bundle" \ BUNDLE_WITHOUT="development" # Install packages needed to build gems and node modules RUN apt-get update -qq && \ apt-get install --no-install-recommends -y build-essential curl git libpq-dev libvips node-gyp pkg-config python # Install JavaScript dependencies ARG NODE_VERSION=14.'><meta itemprop=wordCount content="195"><meta property="og:url" content="https://yingkui.com/cs/server/docker/"><meta property="og:site_name" content="Yingkui"><meta property="og:title" content="Yingkui"><meta property="og:description" content="Docker database and app should be treat separately. app install ruby rails node yarn gems ssh git should be handle differently. ruby rails node yarn ###============= # RUBY AND NODE ###============= ARG RUBY_VERSION=3.3.0 FROM registry.docker.com/library/ruby:$RUBY_VERSION-slim # Rails app lives here WORKDIR /rails # Set production environment ENV RAILS_ENV=&amp;#34;production&amp;#34; \ BUNDLE_DEPLOYMENT=&amp;#34;1&amp;#34; \ BUNDLE_PATH=&amp;#34;/usr/local/bundle&amp;#34; \ BUNDLE_WITHOUT=&amp;#34;development&amp;#34; # Install packages needed to build gems and node modules RUN apt-get update -qq &amp;amp;&amp;amp; \ apt-get install --no-install-recommends -y build-essential curl git libpq-dev libvips node-gyp pkg-config python # Install JavaScript dependencies ARG NODE_VERSION=14."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="cs"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content='Docker database and app should be treat separately. app install ruby rails node yarn gems ssh git should be handle differently. ruby rails node yarn ###============= # RUBY AND NODE ###============= ARG RUBY_VERSION=3.3.0 FROM registry.docker.com/library/ruby:$RUBY_VERSION-slim # Rails app lives here WORKDIR /rails # Set production environment ENV RAILS_ENV="production" \ BUNDLE_DEPLOYMENT="1" \ BUNDLE_PATH="/usr/local/bundle" \ BUNDLE_WITHOUT="development" # Install packages needed to build gems and node modules RUN apt-get update -qq && \ apt-get install --no-install-recommends -y build-essential curl git libpq-dev libvips node-gyp pkg-config python # Install JavaScript dependencies ARG NODE_VERSION=14.'><link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel=stylesheet type=text/css><link rel=stylesheet type=text/css media=screen href=https://yingkui.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://yingkui.com/css/main.css><link id=dark-scheme rel=stylesheet type=text/css href=https://yingkui.com/css/dark.css><link rel=stylesheet type=text/css href=https://yingkui.com/css/custom.css><script src=https://yingkui.com/js/feather.min.js></script><script src=https://yingkui.com/js/main.js></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://yingkui.com/><img src=/logo-ai.jpg alt=Yingkui></a></div><h1 class=site-title><a href=https://yingkui.com/>Yingkui</a></h1><div class=site-description><p>Solving Problems. Making Progress.</p><nav class="nav social"><ul class=flat><li><a href=https://github.com/lin title=Github><i data-feather=github></i></a></li><li><a href=https://youtube.com/@yingkui title=YouTube><i data-feather=youtube></i></a></li></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>随想</a></li><li><a href=/edu>《教学》</a></li><li><a href=/life>《人生》</a></li><li><a href=/ai>《智力》</a></li><li><a href=/about>关于</a></li></ul></nav></div><div class=post><div class=post-header><div class=matter><h1 class=title></h1></div></div><div class=markdown><h2 id=docker>Docker</h2><ol><li>database and app should be treat separately.</li><li>app install ruby rails node yarn gems</li><li>ssh git should be handle differently.</li><li>ruby rails node yarn</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e>###=============</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># RUBY AND NODE</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###=============</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> RUBY_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>.3.0<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> registry.docker.com/library/ruby:$RUBY_VERSION-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Rails app lives here</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /rails</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set production environment</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> RAILS_ENV<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;production&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    BUNDLE_DEPLOYMENT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    BUNDLE_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/usr/local/bundle&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    BUNDLE_WITHOUT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;development&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install packages needed to build gems and node modules</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update -qq <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install --no-install-recommends -y build-essential curl git libpq-dev libvips node-gyp pkg-config python<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install JavaScript dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> NODE_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>.15.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> YARN_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.22.17<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PATH<span style=color:#f92672>=</span>/usr/local/node/bin:$PATH<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /tmp/node-build-master/bin/node-build <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>NODE_VERSION<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> /usr/local/node <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm install -g yarn@$YARN_VERSION <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf /tmp/node-build-master<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install node modules</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package.json yarn.lock ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> yarn install --frozen-lockfile<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy application code</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set the working directory in the container to /myapp</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /a23</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the current directory contents into the container at /a23</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> Gemfile /a23/Gemfile<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> Gemfile.lock /a23/Gemfile.lock<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install any needed packages specified in Gemfile</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> bundle install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of your app&#39;s source code from your host to your image filesystem.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . /a23<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></div><div class=tags></div></div></div><div class="footer wrapper"><nav class=nav><div>2024 © Copyright Yingkui.com All Rights Reserved</div></nav></div><script>feather.replace()</script></body></html>