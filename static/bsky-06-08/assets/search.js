"use strict";(()=>{function IndexInterface(){this.cache=null,this.matcher=null,this.stemmer=null,this.filter=null}IndexInterface.prototype.add;IndexInterface.prototype.append;IndexInterface.prototype.search;IndexInterface.prototype.update;IndexInterface.prototype.remove;function parse_option(value,default_value){return typeof value<"u"?value:default_value}function create_object_array(count){let array=new Array(count);for(let i=0;i<count;i++)array[i]=create_object();return array}function get_keys(obj){return Object.keys(obj)}function create_object(){return Object.create(null)}function concat(arrays){return[].concat.apply([],arrays)}function sort_by_length_down(a,b){return b.length-a.length}function is_array(val){return val.constructor===Array}function is_string(val){return typeof val=="string"}function is_object(val){return typeof val=="object"}function is_function(val){return typeof val=="function"}function pipeline(str,normalize2,split,_collapse){if(str&&(normalize2&&(str=replace(str,normalize2)),this.matcher&&(str=replace(str,this.matcher)),this.stemmer&&str.length>1&&(str=replace(str,this.stemmer)),_collapse&&str.length>1&&(str=collapse(str)),split||split==="")){let words=str.split(split);return this.filter?filter(words,this.filter):words}return str}var regex_whitespace=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function init_filter(words){let filter2=create_object();for(let i=0,length=words.length;i<length;i++)filter2[words[i]]=1;return filter2}function init_stemmer_or_matcher(obj,is_stemmer){let keys=get_keys(obj),length=keys.length,final=[],removal="",count=0;for(let i=0,key,tmp;i<length;i++)key=keys[i],tmp=obj[key],tmp?(final[count++]=regex(is_stemmer?"(?!\\b)"+key+"(\\b|_)":key),final[count++]=tmp):removal+=(removal?"|":"")+key;return removal&&(final[count++]=regex(is_stemmer?"(?!\\b)("+removal+")(\\b|_)":"("+removal+")"),final[count]=""),final}function replace(str,regexp){for(let i=0,len=regexp.length;i<len&&(str=str.replace(regexp[i],regexp[i+1]),!!str);i+=2);return str}function regex(str){return new RegExp(str,"g")}function collapse(string){let final="",prev="";for(let i=0,len=string.length,char;i<len;i++)(char=string[i])!==prev&&(final+=prev=char);return final}function filter(words,map2){let length=words.length,filtered=[];for(let i=0,count=0;i<length;i++){let word=words[i];word&&!map2[word]&&(filtered[count++]=word)}return filtered}function encode(str){return pipeline.call(this,(""+str).toLowerCase(),!1,regex_whitespace,!1)}var global_lang={},global_charset={};function async_default(prototype){register(prototype,"add"),register(prototype,"append"),register(prototype,"search"),register(prototype,"update"),register(prototype,"remove")}function register(prototype,key){prototype[key+"Async"]=function(){let self2=this,args=arguments,arg=args[args.length-1],callback;is_function(arg)&&(callback=arg,delete args[args.length-1]);let promise=new Promise(function(resolve){setTimeout(function(){self2.async=!0;let res=self2[key].apply(self2,args);self2.async=!1,resolve(res)})});return callback?(promise.then(callback),this):promise}}function intersect(arrays,limit,offset,suggest){let length=arrays.length,result=[],check,check_suggest,size=0;suggest&&(suggest=[]);for(let x=length-1;x>=0;x--){let word_arr=arrays[x],word_arr_len=word_arr.length,check_new=create_object(),found=!check;for(let y=0;y<word_arr_len;y++){let arr=word_arr[y],arr_len=arr.length;if(arr_len)for(let z=0,check_idx,id;z<arr_len;z++)if(id=arr[z],check){if(check[id]){if(!x){if(offset)offset--;else if(result[size++]=id,size===limit)return result}(x||suggest)&&(check_new[id]=1),found=!0}if(suggest&&(check_idx=(check_suggest[id]||0)+1,check_suggest[id]=check_idx,check_idx<length)){let tmp=suggest[check_idx-2]||(suggest[check_idx-2]=[]);tmp[tmp.length]=id}}else check_new[id]=1}if(suggest)check||(check_suggest=check_new);else if(!found)return[];check=check_new}if(suggest)for(let x=suggest.length-1,arr,len;x>=0;x--){arr=suggest[x],len=arr.length;for(let y=0,id;y<len;y++)if(id=arr[y],!check[id]){if(offset)offset--;else if(result[size++]=id,size===limit)return result;check[id]=1}}return result}function intersect_union(mandatory,arrays){let check=create_object(),union=create_object(),result=[];for(let x=0;x<mandatory.length;x++)check[mandatory[x]]=1;for(let x=0,arr;x<arrays.length;x++){arr=arrays[x];for(let y=0,id;y<arr.length;y++)id=arr[y],check[id]&&(union[id]||(union[id]=1,result[result.length]=id))}return result}function CacheClass(limit){this.limit=limit!==!0&&limit,this.cache=create_object(),this.queue=[]}var cache_default=CacheClass;function searchCache(query,limit,options){is_object(query)&&(query=query.query);let cache=this.cache.get(query);return cache||(cache=this.search(query,limit,options),this.cache.set(query,cache)),cache}CacheClass.prototype.set=function(key,value){if(!this.cache[key]){let length=this.queue.length;length===this.limit?delete this.cache[this.queue[length-1]]:length++;for(let x=length-1;x>0;x--)this.queue[x]=this.queue[x-1];this.queue[0]=key}this.cache[key]=value};CacheClass.prototype.get=function(key){let cache=this.cache[key];if(this.limit&&cache){let pos=this.queue.indexOf(key);if(pos){let tmp=this.queue[pos-1];this.queue[pos-1]=this.queue[pos],this.queue[pos]=tmp}}return cache};CacheClass.prototype.del=function(id){for(let i=0,item,key;i<this.queue.length;i++)key=this.queue[i],item=this.cache[key],item.includes(id)&&(this.queue.splice(i--,1),delete this.cache[key])};var preset={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function apply_preset(options){if(is_string(options))!1&&!preset[options]&&console.warn("Preset not found: "+options),options=preset[options];else{let preset2=options.preset;preset2&&(!1&&!preset2[preset2]&&console.warn("Preset not found: "+preset2),options=Object.assign({},preset2[preset2],options))}return options}function async(callback,self2,field,key,index_doc,index2,data){setTimeout(function(){let res=callback(field?field+"."+key:key,JSON.stringify(data));res&&res.then?res.then(function(){self2.export(callback,self2,field,index_doc,index2+1)}):self2.export(callback,self2,field,index_doc,index2+1)})}function exportIndex(callback,self2,field,index_doc,index2){let key,data;switch(index2||(index2=0)){case 0:if(key="reg",this.fastupdate){data=create_object();for(let key2 in this.register)data[key2]=1}else data=this.register;break;case 1:key="cfg",data={doc:0,opt:this.optimize?1:0};break;case 2:key="map",data=this.map;break;case 3:key="ctx",data=this.ctx;break;default:return}return async(callback,self2||this,field,key,index_doc,index2,data),!0}function importIndex(key,data){if(data)switch(is_string(data)&&(data=JSON.parse(data)),key){case"cfg":this.optimize=!!data.opt;break;case"reg":this.fastupdate=!1,this.register=data;break;case"map":this.map=data;break;case"ctx":this.ctx=data;break}}function exportDocument(callback,self2,field,index_doc,index2){if(index2||(index2=0),index_doc||(index_doc=0),index_doc<this.field.length){let field2=this.field[index_doc],idx=this.index[field2];self2=this,setTimeout(function(){idx.export(callback,self2,index2?field2:"",index_doc,index2++)||(index_doc++,index2=1,self2.export(callback,self2,field2,index_doc,index2))})}else{let key,data;switch(index2){case 1:key="tag",data=this.tagindex;break;case 2:key="store",data=this.store;break;default:return}async(callback,this,field,key,index_doc,index2,data)}}function importDocument(key,data){if(data)switch(is_string(data)&&(data=JSON.parse(data)),key){case"tag":this.tagindex=data;break;case"reg":this.fastupdate=!1,this.register=data;for(let i=0,index2;i<this.field.length;i++)index2=this.index[this.field[i]],index2.register=data,index2.fastupdate=!1;break;case"store":this.store=data;break;default:key=key.split(".");let field=key[0];key=key[1],field&&key&&this.index[field].import(key,data)}}function handler_default(data){data=data.data;let index2=self._index,args=data.args,task=data.task;switch(task){case"init":let options=data.options||{},factory2=data.factory,encode2=options.encode;options.cache=!1,encode2&&encode2.indexOf("function")===0&&(options.encode=Function("return "+encode2)()),factory2?(Function("return "+factory2)()(self),self._index=new self.FlexSearch.Index(options),delete self.FlexSearch):self._index=new src_default(options);break;default:let id=data.id,message=index2[task].apply(index2,args);postMessage(task==="search"?{id,msg:message}:{id})}}var pid=0;function WorkerIndex(options){if(!(this instanceof WorkerIndex))return new WorkerIndex(options);let opt;options?is_function(opt=options.encode)&&(options.encode=opt.toString()):options={};let factory2=(self||window)._factory;factory2&&(factory2=factory2.toString());let is_node_js2=typeof window>"u"&&self.exports,_self=this;this.worker=create(factory2,is_node_js2,options.worker),this.resolver=create_object(),this.worker&&(is_node_js2?this.worker.on("message",function(msg){_self.resolver[msg.id](msg.msg),delete _self.resolver[msg.id]}):this.worker.onmessage=function(msg){msg=msg.data,_self.resolver[msg.id](msg.msg),delete _self.resolver[msg.id]},this.worker.postMessage({task:"init",factory:factory2,options}))}var worker_default=WorkerIndex;register2("add");register2("append");register2("search");register2("update");register2("remove");function register2(key){WorkerIndex.prototype[key]=WorkerIndex.prototype[key+"Async"]=function(){let self2=this,args=[].slice.call(arguments),arg=args[args.length-1],callback;is_function(arg)&&(callback=arg,args.splice(args.length-1,1));let promise=new Promise(function(resolve){setTimeout(function(){self2.resolver[++pid]=resolve,self2.worker.postMessage({task:key,id:pid,args})})});return callback?(promise.then(callback),this):promise}}function create(factory,is_node_js,worker_path){let worker;try{worker=is_node_js?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):factory?new Worker(URL.createObjectURL(new Blob(["onmessage="+handler_default.toString()],{type:"text/javascript"}))):new Worker(is_string(worker_path)?worker_path:"worker/worker.js",{type:"module"})}catch(e){}return worker}function Document(options){if(!(this instanceof Document))return new Document(options);let document2=options.document||options.doc||options,opt;this.tree=[],this.field=[],this.marker=[],this.register=create_object(),this.key=(opt=document2.key||document2.id)&&parse_tree(opt,this.marker)||"id",this.fastupdate=parse_option(options.fastupdate,!0),!0&&(this.storetree=(opt=document2.store)&&opt!==!0&&[],this.store=opt&&create_object()),!0&&(this.tag=(opt=document2.tag)&&parse_tree(opt,this.marker),this.tagindex=opt&&create_object()),!0&&(this.cache=(opt=options.cache)&&new cache_default(opt),options.cache=!1),!0&&(this.worker=options.worker),!0&&(this.async=!1),this.index=parse_descriptor.call(this,options,document2)}var document_default=Document;function parse_descriptor(options,document2){let index2=create_object(),field=document2.index||document2.field||document2;is_string(field)&&(field=[field]);for(let i=0,key,opt;i<field.length;i++)key=field[i],is_string(key)||(opt=key,key=key.field),opt=is_object(opt)?Object.assign({},options,opt):options,!0&&this.worker&&(index2[key]=new worker_default(opt),index2[key].worker||(this.worker=!1)),this.worker||(index2[key]=new src_default(opt,this.register)),this.tree[i]=parse_tree(key,this.marker),this.field[i]=key;if(!0&&this.storetree){let store=document2.store;is_string(store)&&(store=[store]);for(let i=0;i<store.length;i++)this.storetree[i]=parse_tree(store[i],this.marker)}return index2}function parse_tree(key,marker){let tree=key.split(":"),count=0;for(let i=0;i<tree.length;i++)key=tree[i],key.indexOf("[]")>=0&&(key=key.substring(0,key.length-2),key&&(marker[count]=!0)),key&&(tree[count++]=key);return count<tree.length&&(tree.length=count),count>1?tree:tree[0]}function parse_simple(obj,tree){if(is_string(tree))obj=obj[tree];else for(let i=0;obj&&i<tree.length;i++)obj=obj[tree[i]];return obj}function store_value(obj,store,tree,pos,key){if(obj=obj[key],pos===tree.length-1)store[key]=obj;else if(obj)if(is_array(obj)){store=store[key]=new Array(obj.length);for(let i=0;i<obj.length;i++)store_value(obj,store,tree,pos,i)}else store=store[key]||(store[key]=create_object()),key=tree[++pos],store_value(obj,store,tree,pos,key)}function add_index(obj,tree,marker,pos,index2,id,key,_append){if(obj=obj[key],obj)if(pos===tree.length-1){if(is_array(obj)){if(marker[pos]){for(let i=0;i<obj.length;i++)index2.add(id,obj[i],!0,!0);return}obj=obj.join(" ")}index2.add(id,obj,_append,!0)}else if(is_array(obj))for(let i=0;i<obj.length;i++)add_index(obj,tree,marker,pos,index2,id,i,_append);else key=tree[++pos],add_index(obj,tree,marker,pos,index2,id,key,_append)}Document.prototype.add=function(id,content,_append){if(is_object(id)&&(content=id,id=parse_simple(content,this.key)),content&&(id||id===0)){if(!_append&&this.register[id])return this.update(id,content);for(let i=0,tree,field;i<this.field.length;i++)field=this.field[i],tree=this.tree[i],is_string(tree)&&(tree=[tree]),add_index(content,tree,this.marker,0,this.index[field],id,tree[0],_append);if(!0&&this.tag){let tag=parse_simple(content,this.tag),dupes=create_object();is_string(tag)&&(tag=[tag]);for(let i=0,key,arr;i<tag.length;i++)if(key=tag[i],!dupes[key]&&(dupes[key]=1,arr=this.tagindex[key]||(this.tagindex[key]=[]),(!_append||!arr.includes(id))&&(arr[arr.length]=id,this.fastupdate))){let tmp=this.register[id]||(this.register[id]=[]);tmp[tmp.length]=arr}}if(!0&&this.store&&(!_append||!this.store[id])){let store;if(this.storetree){store=create_object();for(let i=0,tree;i<this.storetree.length;i++)tree=this.storetree[i],is_string(tree)?store[tree]=content[tree]:store_value(content,store,tree,0,tree[0])}this.store[id]=store||content}}return this};Document.prototype.append=function(id,content){return this.add(id,content,!0)};Document.prototype.update=function(id,content){return this.remove(id).add(id,content)};Document.prototype.remove=function(id){if(is_object(id)&&(id=parse_simple(id,this.key)),this.register[id]){for(let i=0;i<this.field.length&&(this.index[this.field[i]].remove(id,!this.worker),!this.fastupdate);i++);if(!0&&this.tag&&!this.fastupdate)for(let key in this.tagindex){let tag=this.tagindex[key],pos=tag.indexOf(id);pos!==-1&&(tag.length>1?tag.splice(pos,1):delete this.tagindex[key])}!0&&this.store&&delete this.store[id],delete this.register[id]}return this};Document.prototype.search=function(query,limit,options,_resolve){options||(!limit&&is_object(query)?(options=query,query=""):is_object(limit)&&(options=limit,limit=0));let result=[],result_field=[],pluck,enrich,field,tag,bool,offset,count=0;if(options)if(is_array(options))field=options,options=null;else{if(query=options.query||query,pluck=options.pluck,field=pluck||options.index||options.field,tag=!0&&options.tag,enrich=!0&&this.store&&options.enrich,bool=options.bool==="and",limit=options.limit||limit||100,offset=options.offset||0,tag&&(is_string(tag)&&(tag=[tag]),!query)){for(let i=0,res;i<tag.length;i++)res=get_tag.call(this,tag[i],limit,offset,enrich),res&&(result[result.length]=res,count++);return count?result:[]}is_string(field)&&(field=[field])}field||(field=this.field),bool=bool&&(field.length>1||tag&&tag.length>1);let promises=!_resolve&&(this.worker||this.async)&&[];for(let i=0,res,key,len;i<field.length;i++){let field_options;if(key=field[i],is_string(key)||(field_options=key,key=field_options.field,query=field_options.query||query,limit=field_options.limit||limit),promises){promises[i]=this.index[key].searchAsync(query,limit,field_options||options);continue}else _resolve?res=_resolve[i]:res=this.index[key].search(query,limit,field_options||options);if(len=res&&res.length,tag&&len){let arr=[],count2=0;bool&&(arr[0]=[res]);for(let y=0,key2,res2;y<tag.length;y++)key2=tag[y],res2=this.tagindex[key2],len=res2&&res2.length,len&&(count2++,arr[arr.length]=bool?[res2]:res2);count2&&(bool?res=intersect(arr,limit||100,offset||0):res=intersect_union(res,arr),len=res.length)}if(len)result_field[count]=key,result[count++]=res;else if(bool)return[]}if(promises){let self2=this;return new Promise(function(resolve){Promise.all(promises).then(function(result2){resolve(self2.search(query,limit,options,result2))})})}if(!count)return[];if(pluck&&(!enrich||!this.store))return result[0];for(let i=0,res;i<result_field.length;i++){if(res=result[i],res.length&&enrich&&(res=apply_enrich.call(this,res)),pluck)return res;result[i]={field:result_field[i],result:res}}return result};function get_tag(key,limit,offset,enrich){let res=this.tagindex[key],len=res&&res.length-offset;if(len&&len>0)return(len>limit||offset)&&(res=res.slice(offset,offset+limit)),enrich&&(res=apply_enrich.call(this,res)),{tag:key,result:res}}function apply_enrich(res){let arr=new Array(res.length);for(let x=0,id;x<res.length;x++)id=res[x],arr[x]={id,doc:this.store[id]};return arr}Document.prototype.contain=function(id){return!!this.register[id]};!0&&(Document.prototype.get=function(id){return this.store[id]},Document.prototype.set=function(id,data){return this.store[id]=data,this});!0&&(Document.prototype.searchCache=searchCache);!0&&(Document.prototype.export=exportDocument,Document.prototype.import=importDocument);!0&&async_default(Document.prototype);function Index(options,_register){if(!(this instanceof Index))return new Index(options);let charset,lang,tmp;options?(!0&&(options=apply_preset(options)),charset=options.charset,lang=options.lang,is_string(charset)&&(charset.indexOf(":")===-1&&(charset+=":default"),charset=global_charset[charset]),is_string(lang)&&(lang=global_lang[lang])):options={};let resolution,optimize,context=options.context||{};this.encode=options.encode||charset&&charset.encode||encode,this.register=_register||create_object(),this.resolution=resolution=options.resolution||9,this.tokenize=tmp=charset&&charset.tokenize||options.tokenize||"strict",this.depth=tmp==="strict"&&context.depth,this.bidirectional=parse_option(context.bidirectional,!0),this.optimize=optimize=parse_option(options.optimize,!0),this.fastupdate=parse_option(options.fastupdate,!0),this.minlength=options.minlength||1,this.boost=options.boost,this.map=optimize?create_object_array(resolution):create_object(),this.resolution_ctx=resolution=context.resolution||1,this.ctx=optimize?create_object_array(resolution):create_object(),this.rtl=charset&&charset.rtl||options.rtl,this.matcher=(tmp=options.matcher||lang&&lang.matcher)&&init_stemmer_or_matcher(tmp,!1),this.stemmer=(tmp=options.stemmer||lang&&lang.stemmer)&&init_stemmer_or_matcher(tmp,!0),this.filter=(tmp=options.filter||lang&&lang.filter)&&init_filter(tmp),!0&&(this.cache=(tmp=options.cache)&&new cache_default(tmp))}var src_default=Index;Index.prototype.append=function(id,content){return this.add(id,content,!0)};Index.prototype.add=function(id,content,_append,_skip_update){if(content&&(id||id===0)){if(!_skip_update&&!_append&&this.register[id])return this.update(id,content);content=this.encode(""+content);let length=content.length;if(length){let dupes_ctx=create_object(),dupes=create_object(),depth=this.depth,resolution=this.resolution;for(let i=0;i<length;i++){let term=content[this.rtl?length-1-i:i],term_length=term.length;if(term&&term_length>=this.minlength&&(depth||!dupes[term])){let score=get_score(resolution,length,i),token="";switch(this.tokenize){case"full":if(term_length>2){for(let x=0;x<term_length;x++)for(let y=term_length;y>x;y--)if(y-x>=this.minlength){let partial_score=get_score(resolution,length,i,term_length,x);token=term.substring(x,y),this.push_index(dupes,token,partial_score,id,_append)}break}case"reverse":if(term_length>1){for(let x=term_length-1;x>0;x--)if(token=term[x]+token,token.length>=this.minlength){let partial_score=get_score(resolution,length,i,term_length,x);this.push_index(dupes,token,partial_score,id,_append)}token=""}case"forward":if(term_length>1){for(let x=0;x<term_length;x++)token+=term[x],token.length>=this.minlength&&this.push_index(dupes,token,score,id,_append);break}default:if(this.boost&&(score=Math.min(score/this.boost(content,term,i)|0,resolution-1)),this.push_index(dupes,term,score,id,_append),depth&&length>1&&i<length-1){let dupes_inner=create_object(),resolution2=this.resolution_ctx,keyword=term,size=Math.min(depth+1,length-i);dupes_inner[keyword]=1;for(let x=1;x<size;x++)if(term=content[this.rtl?length-1-i-x:i+x],term&&term.length>=this.minlength&&!dupes_inner[term]){dupes_inner[term]=1;let context_score=get_score(resolution2+(length/2>resolution2?0:1),length,i,size-1,x-1),swap=this.bidirectional&&term>keyword;this.push_index(dupes_ctx,swap?keyword:term,context_score,id,_append,swap?term:keyword)}}}}}this.fastupdate||(this.register[id]=1)}}return this};function get_score(resolution,length,i,term_length,x){return i&&resolution>1?length+(term_length||0)<=resolution?i+(x||0):(resolution-1)/(length+(term_length||0))*(i+(x||0))+1|0:0}Index.prototype.push_index=function(dupes,value,score,id,append,keyword){let arr=keyword?this.ctx:this.map;if((!dupes[value]||keyword&&!dupes[value][keyword])&&(this.optimize&&(arr=arr[score]),keyword?(dupes=dupes[value]||(dupes[value]=create_object()),dupes[keyword]=1,arr=arr[keyword]||(arr[keyword]=create_object())):dupes[value]=1,arr=arr[value]||(arr[value]=[]),this.optimize||(arr=arr[score]||(arr[score]=[])),(!append||!arr.includes(id))&&(arr[arr.length]=id,this.fastupdate))){let tmp=this.register[id]||(this.register[id]=[]);tmp[tmp.length]=arr}};Index.prototype.search=function(query,limit,options){options||(!limit&&is_object(query)?(options=query,query=options.query):is_object(limit)&&(options=limit));let result=[],length,context,suggest,offset=0;if(options&&(query=options.query||query,limit=options.limit,offset=options.offset||0,context=options.context,suggest=!0&&options.suggest),query&&(query=this.encode(""+query),length=query.length,length>1)){let dupes=create_object(),query_new=[];for(let i=0,count=0,term;i<length;i++)if(term=query[i],term&&term.length>=this.minlength&&!dupes[term]){if(!this.optimize&&!suggest&&!this.map[term])return result;query_new[count++]=term,dupes[term]=1}query=query_new,length=query.length}if(!length)return result;limit||(limit=100);let depth=this.depth&&length>1&&context!==!1,index2=0,keyword;depth?(keyword=query[0],index2=1):length>1&&query.sort(sort_by_length_down);for(let arr,term;index2<length;index2++){if(term=query[index2],depth?(arr=this.add_result(result,suggest,limit,offset,length===2,term,keyword),(!suggest||arr!==!1||!result.length)&&(keyword=term)):arr=this.add_result(result,suggest,limit,offset,length===1,term),arr)return arr;if(suggest&&index2===length-1){let length2=result.length;if(length2){if(length2===1)return single_result(result[0],limit,offset)}else{if(depth){depth=0,index2=-1;continue}return result}}}return intersect(result,limit,offset,suggest)};Index.prototype.add_result=function(result,suggest,limit,offset,single_term,term,keyword){let word_arr=[],arr=keyword?this.ctx:this.map;if(this.optimize||(arr=get_array(arr,term,keyword,this.bidirectional)),arr){let count=0,arr_len=Math.min(arr.length,keyword?this.resolution_ctx:this.resolution);for(let x=0,size=0,tmp,len;x<arr_len&&(tmp=arr[x],!(tmp&&(this.optimize&&(tmp=get_array(tmp,term,keyword,this.bidirectional)),offset&&tmp&&single_term&&(len=tmp.length,len<=offset?(offset-=len,tmp=null):(tmp=tmp.slice(offset),offset=0)),tmp&&(word_arr[count++]=tmp,single_term&&(size+=tmp.length,size>=limit)))));x++);if(count){if(single_term)return single_result(word_arr,limit,0);result[result.length]=word_arr;return}}return!suggest&&word_arr};function single_result(result,limit,offset){return result.length===1?result=result[0]:result=concat(result),offset||result.length>limit?result.slice(offset,offset+limit):result}function get_array(arr,term,keyword,bidirectional){if(keyword){let swap=bidirectional&&term>keyword;arr=arr[swap?term:keyword],arr=arr&&arr[swap?keyword:term]}else arr=arr[term];return arr}Index.prototype.contain=function(id){return!!this.register[id]};Index.prototype.update=function(id,content){return this.remove(id).add(id,content)};Index.prototype.remove=function(id,_skip_deletion){let refs=this.register[id];if(refs){if(this.fastupdate)for(let i=0,tmp;i<refs.length;i++)tmp=refs[i],tmp.splice(tmp.indexOf(id),1);else remove_index(this.map,id,this.resolution,this.optimize),this.depth&&remove_index(this.ctx,id,this.resolution_ctx,this.optimize);_skip_deletion||delete this.register[id],!0&&this.cache&&this.cache.del(id)}return this};function remove_index(map2,id,res,optimize,resolution){let count=0;if(is_array(map2))if(resolution){let pos=map2.indexOf(id);pos!==-1?map2.length>1&&(map2.splice(pos,1),count++):count++}else{resolution=Math.min(map2.length,res);for(let x=0,arr;x<resolution;x++)arr=map2[x],arr&&(count=remove_index(arr,id,res,optimize,resolution),!optimize&&!count&&delete map2[x])}else for(let key in map2)count=remove_index(map2[key],id,res,optimize,resolution),count||delete map2[key];return count}!0&&(Index.prototype.searchCache=searchCache);!0&&(Index.prototype.export=exportIndex,Index.prototype.import=importIndex);!0&&async_default(Index.prototype);var SSR_NODE=1,TEXT_NODE=3,EMPTY_OBJ={},EMPTY_ARR=[],SVG_NS="http://www.w3.org/2000/svg",map=EMPTY_ARR.map,isArray=Array.isArray,getKey=vdom=>vdom==null?vdom:vdom.key,patchProperty=(node,key,oldValue,newValue,isSvg)=>{if(key==="style")for(var k in{...oldValue,...newValue})oldValue=newValue==null||newValue[k]==null?"":newValue[k],k[0]==="-"?node[key].setProperty(k,oldValue):node[key][k]=oldValue;else key[0]==="o"&&key[1]==="n"?(key=key.slice(2),typeof oldValue=="function"&&node.removeEventListener(key,oldValue),typeof newValue=="function"&&node.addEventListener(key,newValue)):!isSvg&&key!=="list"&&key!=="form"&&key in node?node[key]=newValue??"":newValue==null||newValue===!1?node.removeAttribute(key):node.setAttribute(key,newValue)},createNode=(vdom,isSvg)=>{var props=vdom.props,node=vdom.type===TEXT_NODE?document.createTextNode(vdom.tag):(isSvg=isSvg||vdom.tag==="svg")?document.createElementNS(SVG_NS,vdom.tag,props.is&&props):document.createElement(vdom.tag,props.is&&props);for(var k in props)patchProperty(node,k,null,props[k],isSvg);for(var i=0;i<vdom.children.length;i++)node.appendChild(createNode(vdom.children[i]=maybeVNode(vdom.children[i]),isSvg));return vdom.node=node},patch=(parent,node,oldVNode,newVNode,isSvg)=>{if(oldVNode!==newVNode)if(oldVNode!=null&&oldVNode.type===TEXT_NODE&&newVNode.type===TEXT_NODE)oldVNode.tag!==newVNode.tag&&(node.nodeValue=newVNode.tag);else if(oldVNode==null||oldVNode.tag!==newVNode.tag)node=parent.insertBefore(createNode(newVNode=maybeVNode(newVNode),isSvg),node),oldVNode!=null&&parent.removeChild(oldVNode.node);else{var tmpVKid,oldVKid,oldKey,newKey,oldProps=oldVNode.props,newProps=newVNode.props,oldVKids=oldVNode.children,newVKids=newVNode.children,oldHead=0,newHead=0,oldTail=oldVKids.length-1,newTail=newVKids.length-1;isSvg=isSvg||newVNode.tag==="svg";for(var i in{...oldProps,...newProps})(i==="value"||i==="selected"||i==="checked"?node[i]:oldProps[i])!==newProps[i]&&patchProperty(node,i,oldProps[i],newProps[i],isSvg);for(;newHead<=newTail&&oldHead<=oldTail&&!((oldKey=getKey(oldVKids[oldHead]))==null||oldKey!==getKey(newVKids[newHead]));)patch(node,oldVKids[oldHead].node,oldVKids[oldHead],newVKids[newHead]=maybeVNode(newVKids[newHead++],oldVKids[oldHead++]),isSvg);for(;newHead<=newTail&&oldHead<=oldTail&&!((oldKey=getKey(oldVKids[oldTail]))==null||oldKey!==getKey(newVKids[newTail]));)patch(node,oldVKids[oldTail].node,oldVKids[oldTail],newVKids[newTail]=maybeVNode(newVKids[newTail--],oldVKids[oldTail--]),isSvg);if(oldHead>oldTail)for(;newHead<=newTail;)node.insertBefore(createNode(newVKids[newHead]=maybeVNode(newVKids[newHead++]),isSvg),(oldVKid=oldVKids[oldHead])&&oldVKid.node);else if(newHead>newTail)for(;oldHead<=oldTail;)node.removeChild(oldVKids[oldHead++].node);else{for(var keyed={},newKeyed={},i=oldHead;i<=oldTail;i++)(oldKey=oldVKids[i].key)!=null&&(keyed[oldKey]=oldVKids[i]);for(;newHead<=newTail;){if(oldKey=getKey(oldVKid=oldVKids[oldHead]),newKey=getKey(newVKids[newHead]=maybeVNode(newVKids[newHead],oldVKid)),newKeyed[oldKey]||newKey!=null&&newKey===getKey(oldVKids[oldHead+1])){oldKey==null&&node.removeChild(oldVKid.node),oldHead++;continue}newKey==null||oldVNode.type===SSR_NODE?(oldKey==null&&(patch(node,oldVKid&&oldVKid.node,oldVKid,newVKids[newHead],isSvg),newHead++),oldHead++):(oldKey===newKey?(patch(node,oldVKid.node,oldVKid,newVKids[newHead],isSvg),newKeyed[newKey]=!0,oldHead++):(tmpVKid=keyed[newKey])!=null?(patch(node,node.insertBefore(tmpVKid.node,oldVKid&&oldVKid.node),tmpVKid,newVKids[newHead],isSvg),newKeyed[newKey]=!0):patch(node,oldVKid&&oldVKid.node,null,newVKids[newHead],isSvg),newHead++)}for(;oldHead<=oldTail;)getKey(oldVKid=oldVKids[oldHead++])==null&&node.removeChild(oldVKid.node);for(var i in keyed)newKeyed[i]==null&&node.removeChild(keyed[i].node)}}return newVNode.node=node},propsChanged=(a,b)=>{for(var i in a)if(!(i in b))return!0;for(var i in b)if(a[i]!==b[i])return!0;return!1},maybeVNode=(newVNode,oldVNode)=>newVNode!==!0&&newVNode!==!1&&newVNode?typeof newVNode.tag=="function"?((!oldVNode||oldVNode.memo==null||propsChanged(oldVNode.memo,newVNode.memo))&&((oldVNode=newVNode.tag(newVNode.memo)).memo=newVNode.memo),oldVNode):newVNode:text(""),recycleNode=node=>node.nodeType===TEXT_NODE?text(node.nodeValue,node):createVNode(node.nodeName.toLowerCase(),EMPTY_OBJ,map.call(node.childNodes,recycleNode),SSR_NODE,node),createVNode=(tag,{key,...props},children,type,node)=>({tag,props,key,children,type,node}),memo=(tag,memo2)=>({tag,memo:memo2}),text=(value,node)=>createVNode(value,EMPTY_OBJ,EMPTY_ARR,TEXT_NODE,node),h=(tag,props,children=EMPTY_ARR)=>createVNode(tag,props,isArray(children)?children:[children]),app=({node,view})=>{var vdom=node&&recycleNode(node),render=()=>node=patch(node.parentNode,node,vdom,vdom=view(render),!1);return render(),render};var index=new document_default({document:{id:"0",index:["1"],store:!0}});{let entries;{let node=document.getElementById("search-json");node.remove(),entries=JSON.parse(node.textContent)}for(let i=0,il=entries.length;i<il;i++){let entry=entries[i];index.add(entry)}}{let handle_filter_button=function(ev){sort!==(sort=ev.target.value)&&(sort_results(),rerender())},handle_search_input=function(ev){let[search_results]=index.search(ev.target.value,200,{enrich:!0});if(results=[],search_results!==void 0){let res=search_results.result;for(let i=0,ilen=res.length;i<ilen;i++){let doc=res[i].doc;doc.idx=i,results.push(doc)}sort!==SORT_RELEVANT&&sort_results()}rerender()},sort_results=function(){sort===SORT_RELEVANT?results.sort((a,b)=>a.idx-b.idx):sort===SORT_NEW?results.sort((a,b)=>b[2]-a[2]):sort===SORT_OLD&&results.sort((a,b)=>a[2]-b[2])},render_filter_btn=function(val,label){let cn="Interactive Interactive--primary Filter"+(sort===val?" Filter--active":"");return h("button",{value:val,class:cn,onclick:handle_filter_button},text(label))},render_search_item=function({item}){let[rkey,post_text,ts,flags]=item;return h("div",{class:"SearchItem__content"},[h("a",{href:`posts/${rkey}.html`,class:"SearchItem__timestamp"},[text(ts===0?"N/A":abs_with_time.format(ts))]),h("p",{class:"SearchItem__body"},[text(post_text)]),(flags&HAS_EMBED_IMAGE)!==0&&h("p",{class:"SearchItem__accessory"},text("[image]"))])};handle_filter_button2=handle_filter_button,handle_search_input2=handle_search_input,sort_results2=sort_results,render_filter_btn2=render_filter_btn,render_search_item2=render_search_item;let abs_with_time=new Intl.DateTimeFormat("en-US",{dateStyle:"long",timeStyle:"short"}),HAS_EMBED_IMAGE=1,HAS_EMBED_LINK=2,HAS_EMBED_RECORD=4,HAS_EMBED_FEED=8,HAS_EMBED_LIST=16,SORT_RELEVANT="relevant",SORT_NEW="new",SORT_OLD="old",results=[],sort=SORT_RELEVANT,rerender=app({node:document.getElementById("root"),view(){return h("div",{},[h("div",{class:"SearchPage__header"},[h("input",{class:"SearchPage__input",oninput:handle_search_input})]),h("div",{class:"Filters"},[render_filter_btn(SORT_RELEVANT,"Relevant"),render_filter_btn(SORT_NEW,"New"),render_filter_btn(SORT_OLD,"Old")]),h("div",{},results.map(item=>h("div",{class:"SearchItem",key:item[0]},[memo(render_search_item,{item})])))])}})}var handle_filter_button2,handle_search_input2,sort_results2,render_filter_btn2,render_search_item2;})();
