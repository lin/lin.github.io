<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tweets 2024</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            color: #0f1419;
        }
        .container {
            width: 100%;
            max-width: 600px;
        }
        .header {
            padding: 10px 16px;
            font-size: 20px;
            font-weight: 700;
            border: 1px solid #eff3f4;
            border-bottom: none;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header svg {
            width: 24px;
            height: 24px;
            fill: #1DA1F2;
        }
        .tweet {
            border: 1px solid #eff3f4;
            border-top: none;
            padding: 12px 16px;
            display: flex;
            gap: 12px;
            transition: background-color 0.2s;
        }
        .tweet:hover {
            background-color: #f7f9f9;
        }
        .tweet:last-child {
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
        }
        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #38d3d6; /* Placeholder color */
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            overflow: hidden;
        }
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .tweet-content {
            flex: 1;
            min-width: 0; /* Fix flex overflow */
        }
        .tweet-header {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 15px;
            margin-bottom: 4px;
        }
        .name {
            font-weight: 700;
            color: #0f1419;
        }
        .handle, .date-separator, .date {
            color: #536471;
        }
        .text {
            font-size: 15px;
            line-height: 20px;
            white-space: pre-wrap;
            margin-bottom: 12px;
            word-wrap: break-word;
        }
        .text a {
            color: #1d9bf0;
            text-decoration: none;
        }
        .text a:hover {
            text-decoration: underline;
        }
        .actions {
            display: flex;
            gap: 20px; /* Approximate spacing */
            color: #536471;
            font-size: 13px;
            align-items: center;
        }
        .action-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .action-item svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        .tweet-footer {
            margin-top: 12px;
            font-size: 13px;
            color: #536471;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .tweet-id {
            font-family: monospace;
            color: #536471;
        }
        .view-link {
            color: #1d9bf0;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }
        .view-link:hover {
            text-decoration: underline;
        }
        
        /* Loading/Error states */
        .message {
            padding: 20px;
            text-align: center;
            color: #536471;
            border: 1px solid #eff3f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span>Tweets</span>
            <svg viewBox="0 0 24 24"><g><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"></path></g></svg>
        </div>
        <div id="tweets-container">
            <div class="message">Loading tweets...</div>
        </div>
    </div>

    <script>
        // Icons
        const ICONS = {
            reply: '<g><path d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.96-1.607 5.68-4.196 7.11l-8.054 4.46v-3.69h-.067c-4.49.1-8.183-3.51-8.183-8.01zm8.005-6c-3.317 0-6.005 2.69-6.005 6 0 3.37 2.77 6.08 6.138 6.01l.351-.01h1.761v2.3l5.087-2.81c1.951-1.08 3.163-3.13 3.163-5.36 0-3.39-2.744-6.13-6.129-6.13H9.756z"></path></g>',
            retweet: '<g><path d="M4.5 3.88l4.432 4.14-1.364 1.46L5.5 7.55V16c0 1.1.896 2 2 2H13v2H7.5c-2.209 0-4-1.79-4-4V7.55L1.364 9.48 0 8.02 4.5 3.88zM18 5.3V14c0 2.21-1.791 4-4 4h-5.5v-2H14c1.104 0 2-.896 2-2V7.55l-1.932 1.93-1.364-1.46L17.5 3.88l4.432 4.14-1.364 1.46L18 7.55z"></path></g>',
            like: '<g><path d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C9.984 6.01 8.528 5.44 7.305 5.5c-1.235.06-2.792 1.03-2.792 2.72 0 1.09.679 2.36 1.726 4.13 1.003 1.68 2.657 3.27 5.467 4.15.584.19 1.206.19 1.791 0 2.811-.88 4.465-2.47 5.467-4.15 1.047-1.77 1.726-3.04 1.726-4.13 0-1.69-1.557-2.66-2.793-2.72zM7.305 3.5c-2.433-.12-4.792 1.75-4.792 4.72 0 1.96 1.144 3.79 2.454 5.96 1.154 1.92 3.132 3.73 6.035 4.65 1.996.63 4.004.63 6.001 0 2.903-.92 4.88-2.73 6.034-4.65 1.31-2.17 2.454-4 2.454-5.96 0-2.97-2.359-4.84-4.792-4.72-1.745.09-3.235.94-4.201 2.26C10.539 4.44 9.049 3.59 7.305 3.5z"></path></g>',
            share: '<g><path d="M12 2.59l5.7 5.7-1.41 1.42L13 6.41V16h-2V6.41l-3.3 3.3-1.41-1.42L12 2.59zM21 15l-.02 3.51c0 1.38-1.12 2.49-2.5 2.49H5.5C4.12 21 3 19.88 3 18.5V15h2v3.5c0 .28.22.5.5.5h12.98c.28 0 .5-.22.5-.5L19 15h2z"></path></g>'
        };

        const AVATAR_URL = 'avatar.jpg'; // Can be set if available, otherwise falls back to initials/color
        const USER_NAME = 'Yingkui Lin';
        
        async function loadTweets() {
            const urlParams = new URLSearchParams(window.location.search);
            const year = urlParams.get('year') || '2024';
            const filename = `tweets_${year}.txt`;
            
            // Update title and header
            document.title = `Tweets in ${year}`;
            const headerSpan = document.querySelector('.header span');
            if (headerSpan) headerSpan.textContent = `Tweets in ${year}`;

            const container = document.getElementById('tweets-container');
            container.innerHTML = `<div class="message">Loading tweets for ${year}...</div>`;

            try {
                const response = await fetch(`${filename}?t=${Date.now()}`);
                if (!response.ok) throw new Error(`Failed to load ${filename}`);
                
                const text = await response.text();
                container.innerHTML = ''; // Clear loading

                const rawTweets = text.split('————').map(t => t.trim()).filter(t => t);

                // Update header with count
                if (headerSpan) headerSpan.textContent = `${rawTweets.length} Tweets in ${year}`;

                rawTweets.forEach(rawTweet => {
                    const lines = rawTweet.split('\n').map(l => l.trim());
                    if (lines.length === 0) return;

                    // Last line is metadata: "Date | ID"
                    // Example: "Jul 5, 2024 | 1809157655132348490"
                    const metaLine = lines.pop();
                    const content = lines.join('\n');
                    
                    let date = '';
                    let id = '';
                    
                    if (metaLine.includes('|')) {
                        [date, id] = metaLine.split('|').map(s => s.trim());
                    } else {
                        // Fallback if format is different
                        date = metaLine;
                    }

                    const tweetEl = document.createElement('div');
                    tweetEl.className = 'tweet';
                    
                    // Parse content for links
                    const linkedContent = content.replace(
                        /(https?:\/\/[^\s]+)/g, 
                        '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'
                    );

                    tweetEl.innerHTML = `
                        <div class="avatar">
                            ${AVATAR_URL ? `<img src="${AVATAR_URL}" alt="${USER_NAME}">` : 'YL'}
                        </div>
                        <div class="tweet-content">
                            <div class="tweet-header">
                                <span class="name">${USER_NAME}</span>
                                <span class="date-separator">·</span>
                                <span class="date">${date}</span>
                            </div>
                            <div class="text">${linkedContent}</div>
                        </div>
                    `;

                    container.appendChild(tweetEl);
                });

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="message">Error loading tweets for ${year}.<br>Make sure ${filename} exists.</div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadTweets);
    </script>
</body>
</html>
